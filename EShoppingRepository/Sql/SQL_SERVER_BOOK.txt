=====CREATE TABLE=====
create table book (
	id int primary key,
	auther_name varchar(100),
	book_detail varchar(2000),
	book_image_src varchar(255),
	book_name varchar(50),
	book_price int,
	isbn_number varchar(13),
	no_of_copies int,
	publishing_year int
)

=====STORE PROCEDURE FOR GET ALL BOOKS=====
create procedure spGetBooks
as
begin
	begin try
		if NOT EXISTS (select * from book)
			print 'BOOKS NOT FOUND'
		else
			begin 
				select * from book
			end
	end try
	begin catch
		select ERROR_MESSAGE() as ErrorMessage
	end catch
end

=====STORE PROCEDURE TO SEARCH=====
create procedure spGetBooks
(
	@search nvarchar(255) = null,
	@filter nvarchar(255) = null,
	@order nvarchar(5) = 'asc'
)
as
declare @sql nvarchar(255)
begin
	begin try
		set @sql = 'select * from book where 1=1';
		if NOT EXISTS (select * from book)
			print 'BOOKS NOT FOUND'
		else
			begin 
				if @search is not null
					set @sql = @sql + ' and auther_name like %' + @search + '% union book_name like %' + @search + '%';
				
				if @filter is not null
					set @sql = @sql + ' order by ' + @filter + ' ';

				if @filter is null
					set @sql = @sql + ' order by book_name';

				if @order is not null
					set @sql = @sql + ' ' + @order;

				print @sql
				exec sp_executesql @sql
			end
	end try
	begin catch
		select ERROR_MESSAGE() as ErrorMessage
	end catch
end